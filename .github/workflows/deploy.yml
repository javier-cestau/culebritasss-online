name: Deploy to Windows Server

on:
  push:
    branches:
      - "master"

jobs:
  build:
    name: Build
    runs-on: windows-latest
    environment: production

    steps:
    - name: Checkout
      uses: actions/checkout@v3
    - name: Caching Unity
      uses: actions/cache@v3
      with:
        path: "'C:\\Program Files\\Unity"
        key: ${{ runner.os }}-unity
    - name: ðŸŽ® Setup Unity
      uses: kuler90/setup-unity@v1.0.8
      with:
        unity-version: 2021.3.4f1
    - name: Debugging with tmate
      uses: mxschmitt/action-tmate@v3.11
    - name: Building Game server
      run: "'C:\\Program Files\\Unity\\Hub\\Editor\\2021.3.4f1\\Editor\\Unity.exe' -- -batchmode -quit -logFile out.log -projectPath './' -executeMethod 'Editor.Builder.Build' -platform 'Win-Server'"    - uses: actions/upload-artifact@v2
      with:
        name: build-server
        path: ./Builds/Win-Server
  deploy:
    needs: build
    name: Deploy
    runs-on: ubuntu-latest
    steps:
    - uses: actions/download-artifact@v2
      with:
        name: build-server
    - name: ðŸ“‚ Pushing Build files
      uses: kevinpainchaud/simple-ftp-deploy-action@v1.2.1
      with:
        ftp_host: ${{ secrets.FTP_HOST }}
        ftp_username: ${{ secrets.FTP_USERNAME }}
        ftp_password: ${{ secrets.FTP_PASSWORD }}
        local_source_dir: "."
        dist_target_dir: "Builds/Win-Server"
        delete: "true"
